<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Management Portal</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='management.css') }}"
    />
  </head>
  <body>
    <h1>Management Portal</h1>

    <!-- Container for tickets -->
    <div id="tickets-container">
      <!-- Example ticket layout -->
      {% for ticket in tickets %}
      <div class="ticket">
        <p><strong>Name:</strong> {{ ticket.name }}</p>
        <p><strong>Unit:</strong> {{ ticket.unit }}</p>
        <p><strong>Details:</strong> {{ ticket.details }}</p>
        <p><strong>Priority:</strong> {{ ticket.priority }}</p>
        <p>
          <strong>Status:</strong>
          <span class="status">{{ ticket.status }}</span>
        </p>
        <button
          class="resolve-btn"
          data-id="{{ ticket.id }}"
          data-category="{{ ticket.category }}"
          {% if ticket.status == 'resolved' %} disabled {% endif %}
        >
          Mark as Resolved
        </button>
      </div>
      {% endfor %}
    </div>

    <!-- JavaScript to handle the "Mark as Resolved" functionality -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const resolveButtons = document.querySelectorAll('.resolve-btn');

        resolveButtons.forEach((button) => {
          button.addEventListener('click', () => {
            const ticketId = button.getAttribute('data-id');
            const category = button.getAttribute('data-category');

            fetch('/resolveTicket', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ id: ticketId, category: category }),
            })
              .then((response) => {
                if (!response.ok) {
                  throw new Error('Network response was not ok');
                }
                return response.json();
              })
              .then((data) => {
                alert(data.message);
                button.parentElement.querySelector('.status').innerText =
                  'resolved';
                button.disabled = true; // Disable the button after resolving
              })
              .catch((error) => {
                console.error('Error:', error);
                alert('Failed to resolve ticket. Please try again.');
              });
          });
        });
      });
    </script>
  </body>
</html>
